# Thread

- Thread란 프로세스 실행의 단위이며, 하나의 프로세스는 여러개의 쓰레드로 구성이 가능하다.
- 하나의 프로세스를 구성하는 Thread들은 프로세스에 할당된 메모리, 자원등을 공유한다.
- 프로세스와 같이 실행, 준비, 대기 등의 상태를 가지며 상태가 변할떄 마다 __Context switching__ 을 수행한다.
- 각 Thread 별로 자신만의 스택과 레지스터를 가진다.  

<img src="https://goodgid.github.io/assets/img/os/what_is_thread_1.png"><br/>

## Process와 Thread의 차이

프로세스는 __실행중인 프로그램__ 으로, 디스크로부터 메모리에 적재되어 CPU의 할당을 받을 수 있는것을 말한다. 프로세스 생성은 많은 시간과 자원을 소비한다.  

쓰레드는 __프로세스의 실행 단위__ 이다. 운영체제로부터 자원을 할당받은 프로세스의 자원을 이용하는 실행의 단위인것이다. 
- 한 프로세스 내에서 동작되는 여러 실행 흐름으로 프로세스 내의 주소공간이나 자원을 공유할 수 있다.  
- 스케줄러에 의해 CPU를 할당받았다가 선점당하는것을 반복하기 때문에, 현재값을 나타내는 PC Resister를 쓰레드마다 독립적으로 할당한다. 
- 독립적인 함수 호출과 실행 흐름을 가지기위해, 스택 메모리 공간을 독립적으로 할당한다.  

## Thread의 장점

- 프로세스보다 생성 및 종료시간, 쓰레드간 전환시간이 짧다
- 프로세스의 메모리, 자원등을 공유하므로 커널의 도움없이 상호간에 통신이 가능하다.  

## Thread 동기화 방법

- __뮤텍스 (Mutual Exclusion)__ : 쓰레드의 동시 접근을 허용하지 않는것. 임계영역에 들거가기 위해 뮤텍스를 가지고 있어야 들어갈 수 있다. 자물쇠와 같은 역할이다.
- __세마포어 (Semaphore)__ : 뮤텍스와 비슷하지만 동시 접근 동기화가 아닌 __접근 순서 동기화__ 와 더 관련이 있다.
- __모니터 (Moniotr)__ : 뮤텍스와 Condition Variables(Queue)을 가지고 있는 동기화 메카니즘이다.  

```
뮤텍스와 모니터는 상호 배제를 함으로써 임계구역에 하나의 쓰레드만 들어갈 수 있다.  

세마포어는 하나의 쓰레드(binary semaphore)만 들어가거나 여러개의 쓰레드(counting semaphore)가 들어가게 할 수도 있다.
```

### 뮤텍스와 모니터의 차이

__뮤텍스__ 는 다른 프로세스간에 동기화를 위해 사용하고, 운영체제 커널에 의해 제공이 된다. 따라서 무겁고 느리다.  

__모니터__ 는 하나의 프로세스 내에서 다른 쓰레드 간에 동기화를 위해 사용되고, 프레임워크나 라이브러리 그 자체에서 제공된다. 따라서 가볍고 빠르다.  

### 뮤텍스와 세마포어의 차이

- 세마포어는 소유할 수 없지만, 뮤텍스는 소유할 수 있고 소유자가 이에 책임을 진다.
- 세마포어는 하나 이상을 동기화 할 수 있지만 뮤텍스는 1개만 동기화가 된다.  

### 세마포어와 모니터의 차이

- Java에서는 모니터를 모든 객체에게 기본적으로 제공하고 있는 반면 C에서는 모니터를 사용할 수 없다.
- 세마포어는 카운터라는 변수값으로 프로그래머가 상호 배제나 정렬의 목적으로 사용시, 매번 값을 따로 지정해야하는 등 조금 번거롭다.
- 반면 모니터는 이러한 일들이 캡슐화 되어 있어서 개발자는 카운터값을 0 또는 1으로 주어야 하는 고민을 할 필요 없이 synchronized, wait(), notify()등의 키워드를 이용해 좀 더 편하게 동기화 할 수 있다.  

```
변기가 하나뿐인 화장실에서는  
앞의 사람이 볼일을 마치고 나가야 다음 사람이 들어갈 수 있다.  
이렇게 한번에 오직 하나만 처리할 수 있는 대상에 사용하는 것이 뮤텍스이다.   
  
변기가 세개인 화장실에서는 동시에 세 사람이 볼일을 볼 수 있고 
이 세 사람 중 아무나 한명이 나오면 다음 사람이 볼일을 볼 수 있다. 
이렇게 동시에 제한된 수의 여러 처리가 가능하면 세마포어이다. 

만약 변기 세개짜리 화장실의 각 변기에 대해 뮤텍스를 사용한다면 
대기중인 사람은 각 변기 앞에 줄을 서는 것이고 
이렇게 되면 옆 칸이 비어도 들어가지 못하게 된다. 

만약 변기 세개를 묶어서 뮤텍스를 사용한다면 
변기 수에 관계없이 무조건 한명만 사용할 수 있게 된다. 

이 예에서 변기는 동기화 대상, 사람은 그 동기화 대상에 접근하는 쓰레드를 나타낸다. 

뮤텍스와 세마포어의 목적은 특정 동기화 대상이 이미 특정 쓰레드에 의해 사용중일 경우 
다른 쓰레드가 해당 동기화 대상에 접근하는 것을 제한하는 것으로 동일하지만 
관리하는 동기화 대상이 몇개 인가에 따라 차이가 생기게 되는 것이다.
```



### 출처
- https://goodgid.github.io/What-is-Thread/